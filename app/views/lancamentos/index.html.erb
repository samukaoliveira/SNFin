<% content_for :title, "LanÃ§amentos" %>

<div class="panel">

  <!-- ===== RESUMO ===== -->
  <div class="cards">

      <div class="card saldo">
          <h3><i class="fa-solid fa-sack-dollar"></i> Saldo em Caixa</h3>
          <% if @competencia_atual.saldo < 0 %>
              <p class="despesa">R$ <%= @competencia_atual.saldo %></p>
          <% else %>
              <p class="receita">R$ <%= @competencia_atual.saldo %></p>
          <% end %>
      </div>

      <div class="card">
          <h3><i class="fa-solid fa-arrow-trend-up"></i> Receitas previstas</h3>
          <p class="receita">R$ <%= @competencia_atual.total_receitas_previstas %></p>
      </div>

      <div class="card">
          <h3><i class="fa-solid fa-arrow-trend-down"></i> Despesas previstas</h3>
          <p class="despesa">R$ <%= @competencia_atual.total_despesas_previstas %> </p>
      </div>

      <div class="card">
          <h3><i class="fa-solid fa-circle-check"></i> Receitas realizadas</h3>
          <p class="receita">R$ <%= @competencia_atual.todas_as_receitas_cadastradas %></p>
      </div>

      <div class="card">
          <h3><i class="fa-solid fa-circle-xmark"></i> Despesas realizadas</h3>
          <p class="despesa">R$ <%= @competencia_atual.todas_as_despesas_cadastradas %></p>
      </div>
  </div>

  <!-- AÃ‡Ã•ES -->
  <div class="acoes">
      <button class="add-lancamento-btn" onclick="openModal()">
          <i class="fa-solid fa-circle-plus"></i> Novo LanÃ§amento
      </button>
  </div>


  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th class="col-date">Data</th>
        <th>DescriÃ§Ã£o</th>
        <th class="col-natureza">Natureza</th>
        <th class="col-value text-right">Valor</th>
        <th class="col-paid text-center">Pago</th>
      </tr>
    </thead>

    <tbody>

      <!-- ================= CARTÃ•ES / FATURAS ================= -->
      <% @faturas.each do |fatura| %>
        <tr class="row-fatura">
          <td class="col-date">
            <%= "%02d/%02d" % [fatura.mes, fatura.ano % 100] %>
          </td>

          <td class="strong">
            ðŸ’³ <%= fatura.cartao.nome %>
          </td>

          <td>
            <%= link_to "Ver fatura",
                cartao_fatura_path(fatura.cartao, fatura),
                class: "btn btn-primary btn-sm" %>
          </td>

          <td class="text-right text-danger strong">
            <%= number_to_currency(fatura.lancamentos.sum(:valor)) %>
          </td>

          <td></td>
        </tr>
      <% end %>

      <!-- ================= LANÃ‡AMENTOS NORMAIS ================= -->
      <% @lancamentos.each do |l| %>
        <tr>
          <td class="col-date">
            <%= l.data.strftime("%d/%m") %>
          </td>

          <td>
            <%= l.descricao.capitalize %>
          </td>

          <td class="col-natureza">
            <span class="badge badge-<%= l.despesa? ? 'danger' : 'success' %>">
              <%= l.natureza.capitalize %>
            </span>
          </td>

          <td class="text-right <%= l.despesa? ? 'text-danger' : 'text-success' %>">
            <%= number_to_currency(l.valor) %>
          </td>

          <td class="text-center">
            <input type="checkbox"
                   <%= "checked" if l.pago %>
                   data-url="<%= toggle_pago_lancamento_path(l) %>"
                   data-csrf="<%= form_authenticity_token %>"
                   class="js-pago">
          </td>
        </tr>
      <% end %>

      <% if @faturas.empty? && @lancamentos.empty? %>
        <tr>
          <td colspan="5" class="empty">
            Nenhum lanÃ§amento nesta competÃªncia
          </td>
        </tr>
      <% end %>

    </tbody>
  </table>
</div>

